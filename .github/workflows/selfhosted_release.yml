trigger: none 

resources:
  pipelines:
    - pipeline: buildPipeline  
      source: buildPipeline    
      trigger:
        branches:
          include:
            - dev
            - release
            - main
            - prod

pool:
  name: SegAPI

variables:
  buildConfiguration: 'Release'

stages:
- stage: Release
  jobs:
  - job: PublishJob
    steps:
      - checkout: self
        displayName: 'üì• Clonar el repositorio'

      - download: buildPipeline
        artifact: functionapp
        displayName: '‚¨áÔ∏è Descargar artefactos desde buildPipeline'

      - task: UseDotNet@2
        displayName: 'üß∞ Instalar .NET 8 SDK'
        inputs:
          packageType: 'sdk'
          version: '8.0.x'
          installationPath: $(Agent.ToolsDirectory)/dotnet

      - task: AzureFunctionApp@1
        displayName: 'üöÄ Desplegar Azure Function App'
        inputs:
          azureSubscription: 'UVGeniosServiceConFun'
          appType: functionApp
          appName: 'UVGeniosFunction'
          package: '$(Pipeline.Workspace)/buildPipeline/functionapp'
